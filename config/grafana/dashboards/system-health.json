{
  "uid": "nettap-system-health",
  "title": "System Health",
  "description": "NetTap appliance health monitoring â€” CPU, RAM, disk, SSD, and service status. Configure JSON API datasource for live metrics from the storage daemon.",
  "tags": ["nettap", "system", "health", "monitoring"],
  "editable": true,
  "graphTooltip": 0,
  "time": {
    "from": "now-6h",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": ["30s", "1m", "5m"],
    "time_options": ["1h", "6h", "12h", "24h"]
  },
  "refresh": "1m",
  "schemaVersion": 39,
  "panels": [
    {
      "id": 1,
      "title": "System Health Overview",
      "type": "text",
      "gridPos": { "x": 0, "y": 0, "w": 24, "h": 3 },
      "options": {
        "mode": "markdown",
        "content": "## NetTap Appliance Health\n\nThis dashboard shows appliance health metrics from the NetTap storage daemon. The panels below use static thresholds as placeholders. To enable live data:\n\n1. Install the **JSON API** datasource plugin: `GF_INSTALL_PLUGINS=marcusolsson-json-datasource`\n2. Add a JSON API datasource pointing to `http://nettap-storage-daemon:8880/api/v1/health`\n3. Update each panel below to use the JSON API datasource with appropriate JSONPath queries\n\n---"
      }
    },
    {
      "id": 2,
      "title": "CPU Usage",
      "type": "gauge",
      "gridPos": { "x": 0, "y": 3, "w": 5, "h": 6 },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100,
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "#73BF69", "value": null },
              { "color": "#FADE2A", "value": 50 },
              { "color": "#FF9830", "value": 75 },
              { "color": "#F2495C", "value": 90 }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "showThresholdLabels": false,
        "showThresholdMarkers": true,
        "orientation": "auto"
      },
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "datasource",
            "uid": "-- Dashboard --"
          }
        }
      ],
      "description": "CPU utilization percentage. Connect to JSON API datasource at `/api/v1/health` and use JSONPath `$.cpu.percent` for live data."
    },
    {
      "id": 3,
      "title": "RAM Usage",
      "type": "gauge",
      "gridPos": { "x": 5, "y": 3, "w": 5, "h": 6 },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100,
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "#73BF69", "value": null },
              { "color": "#FADE2A", "value": 60 },
              { "color": "#FF9830", "value": 80 },
              { "color": "#F2495C", "value": 95 }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "showThresholdLabels": false,
        "showThresholdMarkers": true,
        "orientation": "auto"
      },
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "datasource",
            "uid": "-- Dashboard --"
          }
        }
      ],
      "description": "RAM utilization percentage. Connect to JSON API datasource at `/api/v1/health` and use JSONPath `$.memory.percent` for live data."
    },
    {
      "id": 4,
      "title": "Disk Usage",
      "type": "gauge",
      "gridPos": { "x": 10, "y": 3, "w": 5, "h": 6 },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100,
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "#73BF69", "value": null },
              { "color": "#FADE2A", "value": 60 },
              { "color": "#FF9830", "value": 80 },
              { "color": "#F2495C", "value": 90 }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "showThresholdLabels": false,
        "showThresholdMarkers": true,
        "orientation": "auto"
      },
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "datasource",
            "uid": "-- Dashboard --"
          }
        }
      ],
      "description": "Disk utilization percentage. The storage daemon triggers pruning at 80%. Connect to JSON API datasource at `/api/v1/health` and use JSONPath `$.disk.percent` for live data."
    },
    {
      "id": 5,
      "title": "SSD Health",
      "type": "gauge",
      "gridPos": { "x": 15, "y": 3, "w": 5, "h": 6 },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100,
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "#F2495C", "value": null },
              { "color": "#FF9830", "value": 10 },
              { "color": "#FADE2A", "value": 30 },
              { "color": "#73BF69", "value": 50 }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "showThresholdLabels": false,
        "showThresholdMarkers": true,
        "orientation": "auto"
      },
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "datasource",
            "uid": "-- Dashboard --"
          }
        }
      ],
      "description": "SSD remaining life percentage (from SMART data). Higher is better. Connect to JSON API datasource at `/api/v1/health` and use JSONPath `$.smart.life_remaining_percent` for live data."
    },
    {
      "id": 6,
      "title": "Uptime",
      "type": "stat",
      "gridPos": { "x": 20, "y": 3, "w": 4, "h": 6 },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "#73BF69", "value": null }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "orientation": "auto",
        "textMode": "auto",
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "auto"
      },
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "datasource",
            "uid": "-- Dashboard --"
          }
        }
      ],
      "description": "System uptime. Connect to JSON API datasource at `/api/v1/health` and use JSONPath `$.uptime` for live data."
    },
    {
      "id": 7,
      "title": "Service Status",
      "type": "text",
      "gridPos": { "x": 0, "y": 9, "w": 12, "h": 8 },
      "options": {
        "mode": "markdown",
        "content": "### Container Services\n\n| Service | Container | Expected Port | Purpose |\n|---------|-----------|---------------|---------|\n| OpenSearch | `nettap-opensearch` | 9200 | Data store |\n| Dashboards | `nettap-dashboards` | 5601 | OpenSearch Dashboards |\n| Logstash | `nettap-logstash` | 5044, 9600 | Log pipeline |\n| Filebeat | `nettap-filebeat` | - | Log shipper |\n| Zeek | `nettap-zeek-live` | - | Network metadata |\n| Suricata | `nettap-suricata-live` | - | IDS alerts |\n| PCAP Capture | `nettap-pcap-capture` | - | Raw packet capture |\n| Arkime | `nettap-arkime-live` | 8005 | PCAP indexing |\n| Redis | `nettap-redis` | 6379 | Cache/queue |\n| API | `nettap-api` | - | Malcolm API |\n| Nginx Proxy | `nettap-nginx-proxy` | 9443 | Malcolm proxy |\n| Storage Daemon | `nettap-storage-daemon` | 8880 | Retention manager |\n| Web UI | `nettap-web` | 3000 | SvelteKit dashboard |\n| Nginx | `nettap-nginx` | 443, 80 | Edge reverse proxy |\n| Grafana | `nettap-grafana` | 3000 | Grafana dashboards |\n| tshark | `nettap-tshark` | - | Packet analysis |\n| CyberChef | `nettap-cyberchef` | 8443 | Data decoding |\n\n> **Tip:** Use `docker ps --format 'table {{.Names}}\\t{{.Status}}'` to check running containers."
      }
    },
    {
      "id": 8,
      "title": "Storage Retention Policy",
      "type": "text",
      "gridPos": { "x": 12, "y": 9, "w": 12, "h": 8 },
      "options": {
        "mode": "markdown",
        "content": "### Three-Tier Storage Policy\n\n| Tier | Data Type | Default Retention | Compression | Est. Daily Size |\n|------|-----------|-------------------|-------------|------------------|\n| **Hot** | Zeek metadata logs | 90 days | zstd ~8:1 | 300-800 MB |\n| **Warm** | Suricata alerts | 180 days | zstd ~6:1 | 10-50 MB |\n| **Cold** | Raw PCAP (alert-triggered) | 30 days | zstd ~3:1 | Variable |\n\n### Safeguards\n\n- **Disk threshold:** 80% triggers automatic pruning (oldest cold data first)\n- **SSD SMART monitoring:** Alerts when remaining life drops below 20%\n- **Write coalescing:** 30s log flush intervals to preserve SSD endurance\n- **OpenSearch ILM:** Automatic index rotation via `ilm-policy.json`\n\n### Configuration\n\nRetention periods are configurable via environment variables:\n\n```\nRETENTION_HOT=90      # days for Zeek logs\nRETENTION_WARM=180    # days for Suricata alerts\nRETENTION_COLD=30     # days for raw PCAPs\nDISK_THRESHOLD_PERCENT=80\n```"
      }
    },
    {
      "id": 9,
      "title": "OpenSearch Cluster Health",
      "type": "stat",
      "gridPos": { "x": 0, "y": 17, "w": 8, "h": 4 },
      "datasource": {
        "type": "grafana-opensearch-datasource",
        "uid": "${DS_OPENSEARCH_ZEEK}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "#73BF69", "value": null }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": {
          "calcs": ["sum"],
          "fields": "",
          "values": false
        },
        "orientation": "auto",
        "textMode": "value_and_name",
        "colorMode": "background",
        "graphMode": "area",
        "justifyMode": "auto"
      },
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "grafana-opensearch-datasource",
            "uid": "${DS_OPENSEARCH_ZEEK}"
          },
          "query": "*",
          "alias": "Indexed Documents",
          "metrics": [
            {
              "id": "1",
              "type": "count"
            }
          ],
          "bucketAggs": [],
          "timeField": "ts",
          "queryType": "lucene"
        }
      ],
      "description": "Total Zeek documents indexed in OpenSearch across the selected time range."
    },
    {
      "id": 10,
      "title": "Suricata Events Indexed",
      "type": "stat",
      "gridPos": { "x": 8, "y": 17, "w": 8, "h": 4 },
      "datasource": {
        "type": "grafana-opensearch-datasource",
        "uid": "${DS_OPENSEARCH_SURICATA}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "#73BF69", "value": null }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": {
          "calcs": ["sum"],
          "fields": "",
          "values": false
        },
        "orientation": "auto",
        "textMode": "value_and_name",
        "colorMode": "background",
        "graphMode": "area",
        "justifyMode": "auto"
      },
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "grafana-opensearch-datasource",
            "uid": "${DS_OPENSEARCH_SURICATA}"
          },
          "query": "*",
          "alias": "Suricata Events",
          "metrics": [
            {
              "id": "1",
              "type": "count"
            }
          ],
          "bucketAggs": [],
          "timeField": "timestamp",
          "queryType": "lucene"
        }
      ],
      "description": "Total Suricata events indexed in OpenSearch across the selected time range."
    },
    {
      "id": 11,
      "title": "Index Ingestion Rate",
      "type": "timeseries",
      "gridPos": { "x": 16, "y": 17, "w": 8, "h": 4 },
      "datasource": {
        "type": "grafana-opensearch-datasource",
        "uid": "${DS_OPENSEARCH_ZEEK}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "fillOpacity": 20,
            "lineWidth": 1,
            "pointSize": 5,
            "showPoints": "never",
            "spanNulls": true,
            "scaleDistribution": {
              "type": "linear"
            },
            "stacking": {
              "mode": "none"
            },
            "gradientMode": "opacity"
          }
        },
        "overrides": []
      },
      "options": {
        "tooltip": {
          "mode": "multi"
        },
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "grafana-opensearch-datasource",
            "uid": "${DS_OPENSEARCH_ZEEK}"
          },
          "query": "*",
          "alias": "Docs/interval",
          "metrics": [
            {
              "id": "1",
              "type": "count"
            }
          ],
          "bucketAggs": [
            {
              "id": "2",
              "type": "date_histogram",
              "field": "ts",
              "settings": {
                "interval": "auto",
                "min_doc_count": "0"
              }
            }
          ],
          "timeField": "ts",
          "queryType": "lucene"
        }
      ],
      "description": "Document ingestion rate into OpenSearch over time."
    }
  ],
  "templating": {
    "list": [
      {
        "name": "DS_OPENSEARCH_ZEEK",
        "type": "datasource",
        "query": "grafana-opensearch-datasource",
        "current": {
          "text": "OpenSearch-Zeek",
          "value": "OpenSearch-Zeek"
        },
        "hide": 2,
        "includeAll": false,
        "multi": false,
        "options": [],
        "refresh": 1,
        "regex": "/.*Zeek.*/"
      },
      {
        "name": "DS_OPENSEARCH_SURICATA",
        "type": "datasource",
        "query": "grafana-opensearch-datasource",
        "current": {
          "text": "OpenSearch-Suricata",
          "value": "OpenSearch-Suricata"
        },
        "hide": 2,
        "includeAll": false,
        "multi": false,
        "options": [],
        "refresh": 1,
        "regex": "/.*Suricata.*/"
      }
    ]
  },
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": "-- Grafana --",
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  }
}
